# WitFoo Sigma Rules â€” Splunk Queries
# Generated by WitFoo Sigma Converter
# Total rules: 55


# --- DNS Tunneling Detection (c09dc03e-23e0-5d3c-a605-5d9eb632b6c5) ---
protocol="DNS"
| regex fqdn=".{100,}" | table clientIP,serverIP,fqdn,totalBytes,streamName

# --- C2 Beaconing Activity (8e769ed8-4f63-516c-b5e1-69a8b05f3c5d) ---
messageType="botnet_connection" | table clientIP,serverIP,serverPort,protocol,streamName,matchedLeadRules

# --- Unusual Port Activity (38f913d0-eb55-5d2e-8aa7-61eefe219d6a) ---
protocol IN ("*TCP*", "*UDP*") NOT (serverPort IN ("443", "8443", "8080", "3389", "5432", "3306", "27017", "6379"))
| regex serverPort="^(4[0-9]{4}|[5-9][0-9]{4}|[0-9]{6})$" | table clientIP,serverIP,serverPort,protocol,application

# --- Large Data Transfer (cc59abbb-24b0-5a9b-b95c-6b02a7e3f1c2) ---
totalBytes>=104857600 | table clientIP,serverIP,totalBytes,protocol,application,userName

# --- Port Scan Detection (94e00767-bc73-54ee-891c-0d1133d0ae12) ---
messageType="service_discovery" OR (messageType="ids_event" ruleCategory="*scan*") | table clientIP,serverIP,serverPort,protocol,ruleName,matchedLeadRules

# --- ICMP Anomaly Detection (6e60bb4d-2021-5b0a-9c2a-f5ac65779aee) ---
protocol="ICMP" totalBytes>=1024 | table clientIP,serverIP,totalBytes,streamName

# --- Non-Standard HTTP/HTTPS Port Usage (ce3d5805-5e01-5c1d-8cae-3b475200ed9a) ---
application IN ("*HTTP*", "*http*") NOT (serverPort IN ("80", "443", "8080", "8443")) | table clientIP,serverIP,serverPort,application,uri

# --- Long-Lived Network Connection (4a280e86-419b-5e46-abe9-2df70020709b) ---
messageType="anomalous_behavior" protocol IN ("*TCP*", "*SSL*", "*TLS*") | table clientIP,serverIP,serverPort,protocol,totalBytes,startTimeUTC,endTimeUTC

# --- Suspicious SSL/TLS Certificate (4fe33f21-5e75-572e-9175-7122b6f849bb) ---
(streamName="*zeek*" ruleCategory IN ("*SSL*", "*certificate*", "*X509*")) OR (messageType="ids_event" ruleName IN ("*certificate*", "*self-signed*", "*expired*")) | table clientIP,serverIP,serverPort,fqdn,ruleName,streamName

# --- Executable File Transfer Over Network (fccc3daa-2075-5253-9cb7-6237a14a4f1f) ---
fileName IN ("*.exe", "*.dll", "*.scr", "*.bat", "*.ps1", "*.vbs", "*.msi", "*.elf", "*.sh", "*.py") | table clientIP,serverIP,fileName,fileHash,filePath,totalBytes,uri

# --- NXDOMAIN/DGA Detection (c12ff605-8260-5cbb-af5b-8be79d9e36cf) ---
protocol="DNS" action IN ("*NXDOMAIN*", "*nxdomain*", "*SERVFAIL*") | table clientIP,fqdn,serverIP,streamName

# --- SMB Lateral Movement (162819cf-fcf8-5cb9-a342-4f1834a388e9) ---
serverPort IN ("445", "139") OR streamName IN ("*smb*", "*zeek_smb*") | table clientIP,serverIP,serverPort,userName,fileName,streamName

# --- Authentication Failure (a5bd8123-efcd-5b32-b876-d25249e8eb1e) ---
messageType="auth_failure" | table clientIP,serverIP,userName,application,streamName,severityLabel

# --- Brute Force Indicator (8aab7806-a54b-59a6-9a1b-9970f42ec97d) ---
messageType="auth_failure" severityLabel IN ("high", "critical") | table clientIP,serverIP,userName,application,severityCode,matchedLeadRules

# --- Credential Access Attempt (be26a7dc-4b66-55bc-aa4b-e0069b960f9c) ---
messageType="credential_access" | table clientIP,serverIP,userName,program,filePath,matchedLeadRules

# --- Privilege Escalation (d134c547-be64-589a-94eb-fe05969ead09) ---
messageType="privilege_escalation" | table clientIP,serverIP,userName,program,cve,severityLabel,matchedLeadRules

# --- Administrative Account Activity (42447905-4754-53b3-9772-dbe5b8c3d8b7) ---
userName IN ("*admin*", "*root*", "*Administrator*") severityLabel IN ("high", "critical") | table clientIP,serverIP,userName,application,action,streamName

# --- Malicious Session Detection (0827c275-02b9-5e34-9258-d6ad77f373e7) ---
messageType="malicious_session" | table clientIP,serverIP,userName,application,matchedLeadRules,severityLabel

# --- Defense Evasion Activity (2f252d3e-23b1-50f6-9eba-b8165067769d) ---
messageType="defense_evasion" | table clientIP,serverIP,userName,program,action,matchedLeadRules

# --- Service Discovery Activity (8c303506-bd68-5cd6-a98f-944d27bf0e6c) ---
messageType="service_discovery" | table clientIP,serverIP,serverPort,protocol,userName,matchedLeadRules

# --- Malicious Behavior Detection (d4d56bc1-240b-58e9-a427-d06211773eee) ---
messageType="malicious_behavior" | table clientIP,serverIP,program,fileName,fileHash,matchedLeadRules,severityLabel

# --- Botnet Connection (bced670e-b1e7-5b9f-9968-917bb708c126) ---
messageType="botnet_connection" | table clientIP,serverIP,serverPort,protocol,stixIndicatorIds,matchedLeadRules

# --- Ransomware Download Indicator (11444b32-1bd8-56d1-817f-e9a82457cf64) ---
messageType="ransomware_download" | table clientIP,serverIP,fileName,fileHash,uri,matchedLeadRules,severityLabel

# --- Ransomware Encryption Activity (35ddd011-c568-5bf7-8bc1-3c2c48cb9e01) ---
messageType="ransomware_encryption" | table clientIP,serverIP,fileName,filePath,userName,matchedLeadRules,severityLabel

# --- Malicious Software Detection (33db94d5-bc40-55e5-a122-803f79293d9e) ---
messageType="malicious_software" | table clientIP,fileName,fileHash,filePath,program,matchedLeadRules,ruleName

# --- Blacklisted Process Execution (c8597820-be6a-5d34-85dc-e3a2166e2a18) ---
messageType="blacklisted_process" | table clientIP,userName,program,fileName,filePath,fileHash,matchedLeadRules

# --- Threat Event Detection (56287074-cbcd-5d6a-88cc-c7b70db1058a) ---
messageType="threat_event" | table clientIP,serverIP,ruleName,ruleCategory,program,matchedLeadRules,severityLabel

# --- Endpoint Protection Alert (0505792a-a79b-5fcb-96ee-bb82d8f9e895) ---
messageType="endpoint_protection" | table clientIP,userName,fileName,fileHash,program,action,matchedLeadRules

# --- Data Staging Activity (5d7a00bb-45a8-5123-918e-fbce8d521dcc) ---
messageType="data_staging" | table clientIP,serverIP,userName,fileName,filePath,totalBytes,matchedLeadRules

# --- Data Exfiltration (4a9c6988-4b05-51d0-b019-fa76a56d3a5a) ---
messageType="data_exfiltration" | table clientIP,serverIP,userName,totalBytes,protocol,matchedLeadRules,severityLabel

# --- Data Destruction (0310bb40-a034-52b0-a7c1-8ebc25af5328) ---
messageType="data_destruction" | table clientIP,serverIP,userName,fileName,filePath,matchedLeadRules,severityLabel

# --- Large Outbound Data Transfer (f0efba8d-32db-549d-950d-b339bf124348) ---
clientBytes>=52428800 | table clientIP,serverIP,clientBytes,totalBytes,protocol,userName,application

# --- Suspicious HTTP POST Exfiltration (e71fe11b-3ac4-5762-9689-f129d2ae9207) ---
action="*POST*" clientBytes>=10485760 | table clientIP,serverIP,uri,clientBytes,application,userName

# --- Unauthorized File Transfer (b66c2977-3f6b-5d5f-a90b-f199836711a2) ---

| rex field=fileName "(?<fileNameMatch>.+)"
| eval fileNameCondition=if(isnotnull(fileNameMatch), "true", "false")
| search protocol IN ("*FTP*", "*SCP*", "*SFTP*") OR (serverPort IN ("21", "22", "69") fileNameCondition="true") | table clientIP,serverIP,serverPort,protocol,fileName,totalBytes,userName

# --- Cloud Privilege Escalation (af72779c-1803-5f8c-8a5f-4a9552583bec) ---
messageType="privilege_escalation" streamName IN ("*aws*", "*azure*", "*gcp*", "*cloud*") | table clientIP,userName,application,action,severityLabel,matchedLeadRules

# --- Cloud Configuration Change (1c1ef0ad-ed2c-5d21-a627-1da2bc33e2b0) ---
messageType="config_change" streamName IN ("*aws*", "*azure*", "*gcp*", "*cloud*") | table clientIP,userName,application,action,severityLabel,matchedLeadRules

# --- Cloud API Abuse (ff214e11-8ed2-52fa-b12f-14b5ef347644) ---
streamName IN ("*aws_cloudtrail*", "*azure_activity*", "*gcp_audit*") severityLabel IN ("high", "critical") | table clientIP,userName,application,action,uri,severityLabel

# --- Phishing Email Detection (7a933235-06ec-555f-96ba-3371a531c0e3) ---
messageType="phishing_email" | table emailFrom,emailTo,emailSubject,clientIP,emailSendingServer,matchedLeadRules,severityLabel

# --- Phishing Link Click (f95d4319-a649-5635-be85-f488d8b357c9) ---
messageType="phishing_click" | table userName,clientIP,uri,emailFrom,emailSubject,matchedLeadRules

# --- Policy Violation (0eeb4864-956e-5a11-8cd4-20e3176fe7ae) ---
messageType="policy_violation" | table clientIP,userName,application,action,ruleName,matchedLeadRules

# --- IDS Event Detection (79c8f7cf-8a02-5ce5-ac03-d1817c3ae0fc) ---
messageType="ids_event" | table clientIP,serverIP,serverPort,ruleName,ruleCategory,severityLabel,matchedLeadRules

# --- IPS Action Taken (b557ee31-1109-58a0-8d48-f5f61961ceb1) ---
messageType="ids_action" OR action IN ("*block*", "*drop*", "*reset*", "*deny*") | table clientIP,serverIP,serverPort,ruleName,ruleCategory,action,matchedLeadRules

# --- Content Filter Match (a538c551-98dd-5619-9864-680006f6246e) ---
messageType="content_filter" | table clientIP,serverIP,userName,uri,application,ruleName,matchedLeadRules

# --- Indicator of Compromise Match (cbff388c-58e8-5ada-9528-20bf07c52d9d) ---

| rex field=stixIndicatorIds "(?<stixIndicatorIdsMatch>.+)"
| eval stixIndicatorIdsCondition=if(isnotnull(stixIndicatorIdsMatch), "true", "false")
| search messageType="ioc_match" OR stixIndicatorIdsCondition="true" | table clientIP,serverIP,fqdn,fileHash,stixIndicatorIds,matchedLeadRules,severityLabel

# --- Indicator of Misconfiguration Match (4005ffe7-c887-5239-a0a6-65076fd215bb) ---
messageType="iom_match" | table clientIP,serverIP,serverPort,cve,cveDescription,ruleName,matchedLeadRules

# --- Service Disruption (c3875f59-ef02-50ad-aaa6-cc39dd56d049) ---
messageType="service_disruption" | table clientIP,serverIP,application,action,severityLabel,matchedLeadRules

# --- Degraded Hardware Alert (9c2fd067-2bde-5277-b736-500b2d549772) ---
messageType="degraded_hardware" | table serverIP,serverHostname,application,message,severityLabel,matchedLeadRules

# --- Degraded Service Alert (cf160da6-924f-5c99-99d6-f9978d0ddbc4) ---
messageType="degraded_service" | table serverIP,serverHostname,application,action,message,severityLabel,matchedLeadRules

# --- Financial System Anomaly (aa7de010-3e25-50e4-b43e-978e93da0c4e) ---
messageType="financial_anomaly" | table clientIP,serverIP,userName,application,action,matchedLeadRules,severityLabel

# --- Infrastructure Exploit Attempt (89099789-c049-554d-8e43-b5233eee7d83) ---

| rex field=cve "(?<cveMatch>^CVE-\\d{4}-\\d+)"
| eval cveCondition=if(isnotnull(cveMatch), "true", "false")
| search messageType="exploit_attempt" OR cveCondition="true" | table clientIP,serverIP,serverPort,cve,cveDescription,uri,matchedLeadRules,severityLabel

# --- Suricata High Severity Alert (13044d28-8b43-5eb6-9dab-11cd610bfb7e) ---
streamName="*suricata*" severityCode IN ("1", "2") | table clientIP,serverIP,serverPort,protocol,ruleName,ruleCategory,severityLabel,matchedLeadRules

# --- Suricata ATT&CK Mapped Alert (ce08894a-1962-51b2-8370-da3a61953bb2) ---
streamName="*suricata*"
| regex attackTechniqueIds="T\\d{4}" | table clientIP,serverIP,serverPort,ruleName,ruleCategory,attackTechniqueIds,matchedLeadRules

# --- Zeek Notice Event (4dc0777c-148e-55cf-855a-2a88fcc7f7fc) ---
streamName IN ("*zeek_notice*", "*zeek_weird*") | table clientIP,serverIP,serverPort,protocol,ruleName,message,streamName

# --- Deprecated TLS Version Usage (67a095d3-2652-56e8-95af-19e63ba1f20c) ---
streamName IN ("*zeek_ssl*", "*tls*") message IN ("*TLSv1.0*", "*TLSv1.1*", "*SSLv3*", "*SSLv2*") | table clientIP,serverIP,serverPort,fqdn,message,streamName

# --- Anomalous Network Behavior (7d8315be-17f4-5a48-ba1c-565e88a3680f) ---
messageType="anomalous_behavior" | table clientIP,serverIP,serverPort,protocol,totalBytes,streamName,matchedLeadRules
